version: "v1.0"
name: First pipeline example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: "Cache gems"
    dependencies: []
    task:
      env_vars:
        - name: BUNDLE_PATH
          value: vendor/bundle
      jobs:
      - name: Store gems
        commands:
          - checkout
          - cache restore gems
          - bundle install --path vendor/bundle
          - cache store gems vendor/bundle
          - bundle exec rake

  - name: "Cache restore"
    dependencies: []
    task:
      env_vars:
        - name: BUNDLE_PATH
          value: vendor/bundle
      jobs:
      - name: Bundler 1.16
        commands:
          - checkout
          - cache restore gems
          - bundle exec rake
      - name: Bundler 1.17
        commands:
          - checkout
          - gem update bundler
          - cache restore gems
          - bundle exec rake
